========================================
  سناریوی تست معامله - دو اکانت
========================================
هدف: با دو اکانت (دمو و علی) یک خرید/فروش واقعی انجام دهید و
      تطبیق سفارش، تراکنش، به‌روزرسانی سبد و نوتیفیکیشن را چک کنید.

نیاز: برنامه و backend روشن، دیتا seed شده (python manage.py seed_data --flush)

----------------------------------------
اکانت‌های مورد استفاده
----------------------------------------
  اکانت ۱ (فروشنده):  demo@boursechain.ir   / Demo1234!
  اکانت ۲ (خریدار):   ali@example.com       / Test1234!

یا برعکس (علی فروشنده، دمو خریدار) — هر دو حالت را می‌توانید امتحان کنید.

----------------------------------------
سناریو ۱: سفارش محدود (Limit) — فروش از دمو، خرید از علی
----------------------------------------

۱) با اکانت دمو لاگین کنید.
   برو به: بازار (Market) → یک سهم انتخاب کنید که در سبد دمو دارید، مثلاً «فولاد» (FOLD).
   دمو در سبد ۱۰۰ عدد FOLD دارد.

۲) در صفحه سهم (فولاد):
   - نوع سفارش: Limit (سفارش محدود)
   - نوع: فروش (Sell)
   - تعداد: ۵۰
   - قیمت: مثلاً ۸۷۰۰ (یا نزدیک به قیمت فعلی)
   ثبت سفارش (Place Order).

۳) خروج از دمو، لاگین با اکانت علی (ali@example.com / Test1234!).

۴) همان سهم (فولاد) را باز کنید.
   - نوع سفارش: Limit
   - نوع: خرید (Buy)
   - تعداد: ۵۰
   - قیمت: ۸۷۰۰ یا بالاتر (مثلاً ۸۷۵۰) تا با سفارش فروش دمو تطبیق شود.
   ثبت سفارش.

۵) چک کنید:
   - در هر دو اکانت در صفحه «سفارشات» (Orders) باید یک سفارش با وضعیت Matched ببینید.
   - در «تراکنش‌ها» (Transactions) یک تراکنش جدید با ۵۰ سهم فولاد.
   - در اکانت علی: سبد (Portfolio) باید ۵۰ عدد FOLD اضافه شده باشد.
   - در اکانت دمو: سبد باید ۵۰ عدد FOLD کم شده باشد و موجودی نقد بیشتر شده باشد.
   - هر دو طرف باید نوتیفیکیشن «سفارش تطبیق شد» دریافت کنند.

----------------------------------------
سناریو ۲: سفارش محدود — خرید از علی، فروش از دمو
----------------------------------------

۱) با علی لاگین کنید.
   بازار → مثلاً «چادرملو» (CHML).
   - Limit، خرید (Buy)، تعداد ۳۰، قیمت مثلاً ۸۹۰۰.
   ثبت سفارش.

۲) خروج، لاگین با دمو.
   همان سهم CHML را باز کنید.
   دمو ۲۰۰ عدد CHML در سبد دارد.
   - Limit، فروش (Sell)، تعداد ۳۰، قیمت ۸۹۰۰ (یا کمتر تا با خرید علی تطبیق شود).
   ثبت سفارش.

۳) چک کنید:
   - هر دو سفارش Matched.
   - یک تراکنش جدید.
   - سبد علی: +۳۰ CHML ؛ سبد دمو: -۳۰ CHML و موجودی نقد بیشتر.

----------------------------------------
سناریو ۳: سفارش بازار (Market) — اگر نقدینگی باشد
----------------------------------------

در seed داده، کاربر «تأمین نقدینگی» (liquidity@boursechain.ir) سفارش‌های زیاد limit گذاشته؛
بنابراین معمولاً یک سفارش Market (خرید یا فروش) با همان سهم و تعداد معمولی باید فوراً
با یکی از آن سفارش‌ها تطبیق شود.

۱) با دمو لاگین کنید.
   یک سهم پرحجم مثل «فولاد» (FOLD) را باز کنید.
   - نوع: Market
   - خرید، تعداد مثلاً ۱۰۰
   ثبت سفارش (قیمت خودکار از دفتر سفارش گرفته می‌شود).

۲) چک کنید:
   - سفارش باید Matched شود (یا حداقل Partial).
   - تراکنش و به‌روزرسانی سبد و نوتیفیکیشن.

----------------------------------------
چک‌لیست نهایی (درست کار کردن معامله)
----------------------------------------
  [ ] هر دو اکانت لاگین و خروج درست کار می‌کند.
  [ ] ثبت سفارش Limit خرید/فروش بدون خطا انجام می‌شود.
  [ ] وقتی قیمت خرید >= قیمت فروش، سفارشات تطبیق می‌شوند (Matched).
  [ ] در صفحه سفارشات، وضعیت سفارش به Matched عوض می‌شود.
  [ ] در تراکنش‌ها یک رکورد جدید با مقدار و قیمت درست دیده می‌شود.
  [ ] سبد خریدار: تعداد سهم اضافه شده.
  [ ] سبد فروشنده: تعداد سهم کم شده، موجودی نقد بیشتر شده.
  [ ] نوتیفیکیشن «سفارش تطبیق شد» برای هر دو طرف می‌آید.

========================================
پایان سناریو
========================================
