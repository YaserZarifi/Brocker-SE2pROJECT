# BourseChain - سند تحلیل ریسک (Risk Analysis)

**پروژه**: سامانه کارگزاری بورس آنلاین  
**دانشگاه**: امیرکبیر - درس مهندسی نرم‌افزار ۲  
**تاریخ**: بهمن ۱۴۰۴  

---

## ۱. معرفی

این سند ریسک‌های پروژه BourseChain را شناسایی، ارزیابی و راهکارهای mitigation ارائه می‌دهد.

---

## ۲. متدولوژی ارزیابی

| احتمال | امتیاز | توضیح |
|--------|--------|--------|
| پایین | 1 | کمتر از ۱۰٪ احتمال وقوع |
| متوسط | 2 | ۱۰٪ تا ۵۰٪ احتمال وقوع |
| بالا | 3 | بیش از ۵۰٪ احتمال وقوع |

| تاثیر | امتیاز | توضیح |
|-------|--------|--------|
| پایین | 1 | کاهش کیفیت جزئی |
| متوسط | 2 | تاخیر یا کاهش قابلیت |
| بالا | 3 | شکست پروژه یا از دست رفتن داده |

**امتیاز ریسک** = احتمال × تاثیر (۱ تا ۹)

---

## ۳. ریسک‌های فنی

### R1: خرابی سرویس بلاکچین (Hardhat Node)

| جنبه | جزئیات |
|------|--------|
| **توضیح** | Hardhat node خاموش شود یا در دسترس نباشد |
| **احتمال** | متوسط (2) |
| **تاثیر** | پایین (1) - تراکنش‌ها match می‌شوند ولی روی chain ثبت نمی‌شوند |
| **امتیاز** | 2 |
| **Mitigation** | طراحی non-blocking: BlockchainService فقط بعد از commit DB فراخوانی می‌شود. `blockchain_hash` خالی می‌ماند ولی سایر عملیات ادامه می‌یابد. پیام خطا در لاگ ثبت می‌شود. |

### R2: تداخل Celery و Backend در Migration

| جنبه | جزئیات |
|------|--------|
| **توضیح** | هر دو سرویس همزمان migrate اجرا کنند → conflict دیتابیس |
| **احتمال** | بالا (3) |
| **تاثیر** | متوسط (2) - خطای `duplicate key` |
| **امتیاز** | 6 |
| **Mitigation** | Celery در docker-compose با `entrypoint: []` اجرا می‌شود و migrate نمی‌زند. فقط Backend migrate می‌زند. Celery به `backend: healthy` وابسته است. |

### R3: قطع اتصال WebSocket

| جنبه | جزئیات |
|------|--------|
| **توضیح** | اتصال WebSocket قطع شود (شبکه، restart سرور) |
| **احتمال** | متوسط (2) |
| **تاثیر** | پایین (1) - کاربر باید صفحه را refresh کند |
| **امتیاز** | 2 |
| **Mitigation** | `WebSocketManager` با exponential backoff reconnect می‌کند (حداکثر ۱۰ تلاش). Frontend gracefully degrade می‌کند. |

### R4: محدودیت Docker Hub در ایران

| جنبه | جزئیات |
|------|--------|
| **توضیح** | دسترسی به registry-1.docker.io محدود یا 403 Forbidden |
| **احتمال** | بالا (3) |
| **تاثیر** | متوسط (2) - عدم امکان pull image |
| **امتیاز** | 6 |
| **Mitigation** | استفاده از `docker.arvancloud.ir` به عنوان mirror. تمام imageها در docker-compose از این mirror استفاده می‌کنند. |

### R5: خطای CRLF در entrypoint.sh

| جنبه | جزئیات |
|------|--------|
| **توضیح** | فایل shell با line ending ویندوز (CRLF) در لینوکس اجرا نشود |
| **احتمال** | بالا (3) |
| **تاثیر** | بالا (3) - `exec /entrypoint.sh: no such file or directory` |
| **امتیاز** | 9 |
| **Mitigation** | در Dockerfile: `RUN sed -i 's/\r$//' /entrypoint.sh` قبل از chmod. |

---

## ۴. ریسک‌های امنیتی

### R6: افشای کلید خصوصی (Blockchain)

| جنبه | جزئیات |
|------|--------|
| **توضیح** | Hardhat Account #0 private key در کد یا env قرار دارد |
| **احتمال** | متوسط (2) |
| **تاثیر** | پایین در dev (1) - فقط برای شبکه local استفاده می‌شود |
| **امتیاز** | 2 |
| **Mitigation** | این کلید فقط برای Hardhat local است و هیچ ارزش واقعی ندارد. در production از AWS KMS یا HashiCorp Vault استفاده شود. |

### R7: حملات Replay روی SIWE

| جنبه | جزئیات |
|------|--------|
| **توضیح** | مهاجم امضای SIWE را دوباره ارسال کند |
| **احتمال** | پایین (1) |
| **تاثیر** | متوسط (2) |
| **امتیاز** | 2 |
| **Mitigation** | Nonce یکبار‌مصرف با cache ۵ دقیقه. بعد از verify، nonce حذف می‌شود. Nonce بررسی می‌شود که expire نشده باشد. |

---

## ۵. ریسک‌های پروژه

### R8: تاخیر در تحویل Sprint

| جنبه | جزئیات |
|------|--------|
| **توضیح** | پیچیدگی بیشتر از برآورد اولیه |
| **احتمال** | متوسط (2) |
| **تاثیر** | متوسط (2) |
| **امتیاز** | 4 |
| **Mitigation** | تقسیم کار به وظایف کوچک. استفاده از Modular Monolith برای جداسازی منطقی. تست مداوم. |

---

## ۶. ماتریس ریسک

| ریسک | امتیاز | اولویت |
|------|--------|--------|
| R5 (CRLF) | 9 | بحرانی - **Mitigated** |
| R2 (Celery migration) | 6 | بالا - **Mitigated** |
| R4 (Docker Hub) | 6 | بالا - **Mitigated** |
| R8 (تاخیر) | 4 | متوسط |
| R1, R3, R6, R7 | 2 | پایین - **Mitigated** |

---

## ۷. جمع‌بندی

تمام ریسک‌های بحرانی و با اولویت بالا با تغییرات در طراحی و کد mitigate شده‌اند. ریسک‌های باقی‌مانده قابل قبول و تحت کنترل هستند.
